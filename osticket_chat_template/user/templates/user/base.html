<!DOCTYPE html>
<html lang="en">
<head>
    {% load staticfiles %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{% static 'css/header.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/form.css' %}" type="text/css">
	<link rel="stylesheet" href="{% static 'timeline/css/style.css' %}"> <!-- Resource style -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css" integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    {% block lib %}{% endblock %}
    <title>{{ user.fullname }}</title>
    {% block js %}{% endblock %}
</head>
<body>
<div class="header">
    <nav class="main-menu">
        <ul>
            <li class="dropdown nav-item">
                <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false">
                    <i class="fa fa-bell"></i>
                    <div class="notify"> 
                        <span class="point"></span>
                    </div>
                </a>
                <div class="dropdown-menu dropdown-menu-right mailbox animated zoomIn">
                    <ul>
                        <li>
                            <div class="drop-title">Notifications</div>
                        </li>
                        <li>
                            <div class="slimScrollDiv" style="position: relative; overflow-x: visible; overflow-y: hidden; width: auto; height: 250px;">
                                <div class="message-center" style="overflow: hidden; width: auto; height: 250px;">
                                        
                                </div>
                            </div>
                        </li>
                        
                    </ul>
                </div>
                
            </li>
            <li><a class="list-group-item" href="{% url 'user:homeuser' %}"><i class="fa fa-home fa-fw" aria-hidden="true"></i>&nbsp; Home</a></li>
            <li><a class="list-group-item" href="{% url 'user:detail_user' %}"><i class="fa fa-cog fa-fw" aria-hidden="true"></i>&nbsp; Settings</a></li>
            <li><a class="list-group-item" href="{% url 'user:logout' %}"><i class="fa fa-sign-out" aria-hidden="true"></i>&nbsp; Logout</a></li>
        </ul>
    </nav>
</div>
<br/>
<br/>
<div class="container" id="info_user">
    {% block content %}{% endblock %}
</div>
<audio id="myAudio">
    <source src="{% static 'ping.mp3' %}" type="audio/mpeg">
</audio>
<script>
        var x = document.getElementById("myAudio");
        var userName = {{ username }};
        var chatSocket = new WebSocket(
            'ws://' + window.location.host +
            '/ws/user/' + userName + '/');
        $(".point").hide();
        // nhan message tu server
        chatSocket.onmessage = function(e) {
            var data = JSON.parse(e.data);
            var message = data['message'];
            if (message !=  'give up'){
                var noti = '<a href="#"><div class="mail-contnet"><span class="mail-desc">'+message+'</span></div></a>';
                $('.message-center').prepend(noti);
                $(".point").show();
                x.play();
            }
            setTimeout(function(){
                $("#info_user").load(location.href + " #info_user");
            }, 2000);
        };
    

        chatSocket.onclose = function(e) {
            console.error('Chat socket closed unexpectedly');
        };

        $(".fa-bell").click(function(){
            $(".point").hide();
        });
</script>
</body>
</html>